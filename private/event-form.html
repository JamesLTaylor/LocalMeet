<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Event</title>
  <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../style.css">
  <!-- <link rel="stylesheet" href="../formStyles.css"> -->
  <style>
  </style>
</head>
<body>
  <h2>Create Event</h2>
  <form id="eventForm">
    <table class="event-form-table">
      <tr>
        <td class="event-form-label"><label for="title">Title:</label></td>
        <td class="event-form-input"><input type="text" id="title" name="title" required></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="description">Description:</label></td>
        <td class="event-form-input"><textarea id="description" name="description"></textarea></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="date">Date</label></td>
        <td class="event-form-input"><input type="date" id="date" name="date" required></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="startTime">Start Time</label></td>
        <td class="event-form-input"><input type="time" id="startTime" name="startTime" required></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="duration">Duration</label></td>
        <td class="event-form-input">
          <select id="duration" name="duration" required>
            <option value="1h_or_less">1h or less</option>
            <option value="1_to_2">1 to 2 hours</option>
            <option value="2_to_3">2 to 3 hours</option>
            <option value="3_to_4">3 to 4 hours</option>
            <option value="more_than_4">more than 4h</option>
          </select>
        </td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="locationAddress">Location (address/description):</label></td>
        <td class="event-form-input"><input type="text" id="locationAddress" name="locationAddress"></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="locationPostcode">Location (postcode):</label></td>
        <td class="event-form-input"><input type="text" id="locationPostcode" name="locationPostcode"></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="memberOnly">Regular attendance requires membership?</label></td>
        <td class="event-form-input"><input type="checkbox" id="memberOnly" name="memberOnly"></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="externalRegister">Link/email to register:</label></td>
        <td class="event-form-input">
          <input type="text" id="externalRegister" name="externalRegister" title="Leave blank if there is no registration required">
        </td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="localMeetRegister">Let users register via WareToMeet:</label></td>
        <td class="event-form-input"><input type="checkbox" id="localMeetRegister" name="localMeetRegister"></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="groupTags">Who is this for?</label></td>
        <td class="event-form-input"><select id="groupTags" name="groupTags">
           <option value=""></option>
        </select>
        </td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="categoryTags">What type of event is it?</label></td>
        <td class="event-form-input"><select id="categoryTags" name="categoryTags" title="Select one or more categories for this event.">
          <option value=""></option>
        </select>
        </td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="contactPerson">Contact Person/Organization:</label></td>
        <td class="event-form-input"><input type="text" id="contactPerson" name="contactPerson"></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="contactDetails">Contact Details:</label></td>
        <td class="event-form-input"><input type="text" id="contactDetails" name="contactDetails"></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="contactVisibility">Contact visibility:</label></td>
        <td class="event-form-input">
          <select id="contactVisibility" name="contactVisibility" title="Who can see the contact details?&#013Nobody=Nobody can see your details or contact you. They will need to use the link above.&#013WareToMeetDirect=users can message you but will not see your email until you reply.&#013LoggedIn=logged in users can see your email address.&#013Public=everyone can see your email address.">
            <option value="NOBODY" selected="selected">Nobody</option>
            <option value="LOCAL_MEET_DIRECT">WareToMeetDirect</option>
            <option value="LOGGED_IN">LoggedIn</option>
            <option value="PUBLIC">Everyone</option>
          </select>
        </td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="costIntroductory">Cost (introductory):</label></td>
        <td class="event-form-input"><input type="number" id="costIntroductory" name="costIntroductory" min="0" step="1"></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="costRegular">Cost (regular):</label></td>
        <td class="event-form-input"><input type="number" id="costRegular" name="costRegular" min="0" step="1"></td>
      </tr>
      <tr>
        <td class="event-form-label"><label for="size">Expected event Size:</label></td>
        <td class="event-form-input">
          <select id="size" name="size">
            <option value="TINY">5-10</option>
            <option value="SMALL" selected="selected">10-20</option>
            <option value="MEDIUM">20-50</option>
            <option value="LARGE">50-100</option>
            <option value="HUGE">100+</option>
          </select>
        </td>
      </tr>
    </table>
    <div class="event-form-actions">
      <button type="button" id="btnEventSave">Save</button>
      <button type="button" id="btnEventSaveAndClose">Save &amp; Close</button>
      <button type="button" id="btnEventCancel">Cancel</button>
      <button type="button" id="btnEventDelete">Delete</button>
    </div>
  </form>
  <div id="eventIdDisplay" style="position: fixed; bottom: 10px; right: 20px; font-size: 0.85em; color: #888; background: #f9f9f9; padding: 4px 10px; border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.04);">
    Event ID: <span id="eventIdText"></span>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
  <script src="functions.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', setupForm);
    document.getElementById('btnEventSave').addEventListener('click', function(e) {
      e.preventDefault();
      saveEvent();
    });

    document.getElementById('btnEventSaveAndClose').addEventListener('click', function(e) {
      e.preventDefault();
      saveEvent();
      removeEventFromSession();
      window.location.href = '/';
    });

    document.getElementById('btnEventCancel').addEventListener('click', function(e) {
      removeEventFromSession();
      window.location.href = '/';
    });

    document.getElementById('btnEventDelete').addEventListener('click', function(e) {
      e.preventDefault();
      showDeleteConfirmation();
    });

    // respond to the user pressing enter or clicking off the locationPostcode input.
    document.getElementById('locationPostcode').addEventListener('blur', function() {
      console.log('Postcode lookup for ' + this.value);
      const postCode = this.value;
      if (postCode) {
        // Perform postcode lookup
        result = lookupPostcode(postCode);
      }
    });

    function showDeleteConfirmation() {
      // Create modal
      const modal = document.createElement('div');
      modal.className = 'modal';

      // Create modal
      const modalContent = document.createElement('div');
      modalContent.className = 'modal-content';
      modalContent.innerHTML = `
        <div style="font-size:1.2em;margin-bottom:18px;">Are you sure you want to delete this event?</div>
        <button id="confirmDeleteBtn" style="margin:0 12px 0 0;padding:7px 22px;background:#d9534f;color:#fff;border:none;border-radius:4px;">Delete</button>
        <button id="cancelDeleteBtn" style="padding:7px 22px;background:#eee;color:#333;border:none;border-radius:4px;">Cancel</button>
      `;
      modal.appendChild(modalContent);
      document.body.appendChild(modal);

      document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
        console.log('User confirmed event deletion.');
        // removeEventFromSession();
        window.location.href = '/';
      });
      document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
        console.log('User cancelled event deletion.');
        document.body.removeChild(modal);
      });
    }
  </script>
</body>
</html>
